---
const basePath = "/~cmuntz/";
---
<script is:inline>
document.addEventListener("DOMContentLoaded", () => {
  const copyWhite = `${basePath}assets/icons/copyWhite.svg`;
  const copyCheck = `${basePath}assets/icons/copyCheckWhite.svg`;

    document.querySelectorAll("pre > code").forEach(code => {
      const pre = code.parentElement;
      if (pre.dataset.hasCopyButton) return; // avoid duplicates
      pre.dataset.hasCopyButton = true;

      const wrapper = document.createElement("div");
      wrapper.style.position = "relative";
      pre.parentNode.insertBefore(wrapper, pre);
      wrapper.appendChild(pre);

      //create button
      const button = document.createElement("button");
      button.className = "copy-button";
      button.title = "Copy code";
      button.style = "position:absolute; top:8px; right:8px; background:none; border:none; cursor:pointer;";

      const img = document.createElement("img");
      img.src = copyWhite;
      img.alt = "Copy code";
      img.style.width = "20px";
      img.style.height = "20px";

      button.appendChild(img);
      wrapper.appendChild(button);

      //fallback for http or old browsers
      const fallbackCopy = (text) => {
        const textarea = document.createElement("textarea");
        textarea.value = text;
        textarea.style.position = "absolute";
        textarea.style.left = "-9999px";
        document.body.appendChild(textarea);
        textarea.select();
        try { document.execCommand("copy"); showCopied(); } 
        catch { alert("Copy failed"); }
        document.body.removeChild(textarea);
      };

      const showCopied = () => { 
        img.src = copyCheck; 
        setTimeout(() => { img.src = copyWhite; }, 2000); 
      };
      
      const handleCopy = (text) => { 
        if(navigator.clipboard?.writeText) navigator.clipboard.writeText(text).then(showCopied).catch(()=>fallbackCopy(text)); 
        else fallbackCopy(text); 
      };

      button.addEventListener("click", () => handleCopy(pre.innerText));
    });
  });
</script>

<style>
  .copy-button:hover {
    opacity: 0.8;
  }
</style>
