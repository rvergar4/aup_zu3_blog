---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import BlogPost from "../components/BlogPost.astro";
import { basePath } from "../config";

const pageTitle = "Field Notes on FPGA Learning";

//get all posts
const allPosts = await getCollection("blog");
//filter out drafts
const publishedPosts = allPosts.filter(post => !post.data.draft);

//sort post by date (oldest to newest)
const sortedPosts = publishedPosts.sort((a, b) =>
  a.data.pubDate.valueOf() - b.data.pubDate.valueOf()
);
//get posts from certain directories
const allAUPZU3Posts = sortedPosts.filter(post => post.id.startsWith('aup-zu3/'));
const allOtherBoardPosts = sortedPosts.filter(post => post.id.startsWith('otherboard/'));

//group by difficulty
function groupByDifficulty(posts) {
  const groups = {
    Beginner: [],
    "Simple Projects": [],
    Intermediate: [],
    Advanced: []
  };

  posts.forEach(post => {
    //getting tags array
    const tags = post.data.tags || [];
    //noramalizng for comparison
    const normalizedTags = tags.map(t => t.toLowerCase());
    //match the category
    if (normalizedTags.includes("beginner")) {
      groups.Beginner.push(post);
    }else if (normalizedTags.includes("simple projects")) {
      groups["Simple Projects"].push(post);
    } else if (normalizedTags.includes("intermediate")) {
      groups.Intermediate.push(post);
    } else if (normalizedTags.includes("advanced")) {
      groups.Advanced.push(post);
    }
  });
  return groups;
}

const groupedAUPZU3 = groupByDifficulty(allAUPZU3Posts);
const groupedOther = groupByDifficulty(allOtherBoardPosts);
---

<BaseLayout pageTitle={pageTitle}>
  <h2>Thereâ€™s always more to uncover.</h2>


  <div class="stack-tabs">
    <!-- Inputs must come first -->
    <input type="radio" name="tab" id="tab1" checked hidden />
    <input type="radio" name="tab" id="tab2" hidden />
    <!-- Then the labels -->
    <div class="tab-labels">
      <label for="tab1">AUP-ZU3</label>
      <label for="tab2">Other Board</label>
    </div>
    <!-- Then the panels -->
    <div class="card-panels">

      <section id="card1">
        <div class="index-card">
          <span class="index-card-label">AUP-ZU3 Blog</span>
          <p>The AUP-ZU3 has a lot to explore! Let's get started</p>
          {Object.entries(groupedAUPZU3).map(([difficulty, posts]) => (
            posts.length > 0 && (
              <>
                <h3>{difficulty}</h3>
                <ul>
                  {posts.map(post => (
                    <BlogPost url={`${basePath}posts/${post.id}/`} title={post.data.title} />
                  ))}
                </ul>
              </>
            )
          ))}
        </div>
      </section>

      <section id="card2">
        <div class="index-card">
          <span class="index-card-label">Other Board</span>
          <p>This is another card with a different message.</p>
          {Object.entries(groupedOther).map(([difficulty, posts]) => (
            posts.length > 0 && (
              <>
                <h3>{difficulty}</h3>
                <ul>
                  {posts.map(post => (
                    <BlogPost url={`${basePath}posts/${post.id}/`} title={post.data.title} />
                  ))}
                </ul>
              </>
            )
          ))}
        </div>
      </section>

    </div>
  </div>
</BaseLayout>
