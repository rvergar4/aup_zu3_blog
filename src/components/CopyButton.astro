---
const basePath = "/~cmuntz/";
//const basePath = import.meta.env.BASE_URL || '/';
---
<div id="copy-button-config"
     data-copywhite={`${basePath}assets/icons/copyWhite.svg`}
     data-copycheck={`${basePath}assets/icons/copyCheckWhite.svg`}>
</div>

<script is:inline>

  document.addEventListener("DOMContentLoaded", () => {
    const config = document.getElementById("copy-button-config");
    const copyWhite = config.dataset.copywhite;
    const copyCheck = config.dataset.copycheck;

    document.querySelectorAll("article pre").forEach(pre => {
      const wrapper = document.createElement("div");
      wrapper.style.position = "relative";
      pre.parentNode.insertBefore(wrapper, pre);
      wrapper.appendChild(pre);

      pre.style.padding = "1.1rem";
      pre.style.borderRadius = "2px";

      //create button
      const button = document.createElement("button");
      button.className = "copy-button";
      button.title = "Copy code";
      button.style = "position:absolute; top:2px; right:2px; background:none; border:none; cursor:pointer;";

      const img = document.createElement("img");
      img.src = copyWhite;
      img.alt = "Copy code";
      img.style.width = "20px";
      img.style.height = "20px";

      button.appendChild(img);
      wrapper.appendChild(button);

      //fallback
      const fallbackCopy = (text) => {
        const textarea = document.createElement("textarea");
        textarea.value = text;
        textarea.style.position = "absolute";
        textarea.style.left = "-9999px";
        document.body.appendChild(textarea);
        textarea.select();
        try {
          document.execCommand("copy");
          showCopied();
        } catch {
          alert("Copy failed. Clipboard not supported.");
        }
        document.body.removeChild(textarea);
      };

      //change icons when copied
      const showCopied = () => {
        img.src = copyCheck;
        setTimeout(() => { img.src = copyWhite; }, 2000);
      };

      //copy handler
      const handleCopy = (text) => {
        if (navigator.clipboard?.writeText)
          navigator.clipboard.writeText(text).then(showCopied).catch(() => fallbackCopy(text));
        else
          fallbackCopy(text);
      };

      button.addEventListener("click", () => handleCopy(pre.innerText));
    });
  });
</script>